<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>PyGopherd Manual</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"></HEAD
><BODY
CLASS="REFERENCE"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="REFERENCE"
><A
NAME="PYGOPHERD"
></A
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="TITLE"
>I. PyGopherd Manual</H1
><DIV
CLASS="TOC"
><DL
><DT
><B
>Table of Contents</B
></DT
><DT
><A
HREF="#AEN3"
>pygopherd</A
>&nbsp;--&nbsp;Multiprotocol Information Server</DT
></DL
></DIV
></DIV
><H1
><A
NAME="AEN3"
></A
>pygopherd</H1
><DIV
CLASS="REFNAMEDIV"
><A
NAME="AEN15"
></A
><H2
>Name</H2
>PyGopherd&nbsp;--&nbsp;Multiprotocol Information Server</DIV
><DIV
CLASS="REFSYNOPSISDIV"
><A
NAME="AEN18"
></A
><H2
>Synopsis</H2
><P
><B
CLASS="COMMAND"
>pygopherd</B
>  [<VAR
CLASS="REPLACEABLE"
>configfile</VAR
>]</P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="DESCRIPTION"
></A
><H2
>Description</H2
><P
>	Welcome to <SPAN
CLASS="APPLICATION"
>PyGopherd</SPAN
>.  In a nutshell, <SPAN
CLASS="APPLICATION"
>PyGopherd</SPAN
>
	is a modern dynamic
	multi-protocol hierarchical information server with a pluggable
	modularized extension system, 
	full flexible caching, virtual files and
	folders, and autodetection of file types -- all with support for
	standardized yet extensible per-document metadata. Whew! Read on for
	information on this what all these buzzwords mean.
      </P
><DIV
CLASS="REFSECT2"
><A
NAME="DESCRIPTION.FEATURES"
></A
><H3
>Features</H3
><P
>	  Here are some of <SPAN
CLASS="APPLICATION"
>PyGopherd</SPAN
>'s features:
	</P
><P
></P
><UL
><LI
><P
>Provides built-in support for multiple protocols:
	      HTTP (Web), Gopher+, Gopher (RFC1436), Enhanced Gopher0,
	      and WAP (mobile phones).  Protocols can be enabled or
	      disabled as desired.
	    </P
></LI
><LI
><P
>Provides protocol autodetection.  That is,
	      <SPAN
CLASS="APPLICATION"
>PyGopherd</SPAN
> can listen for all the above protocols
	      <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>on a single port</I
></SPAN
> and will
	      automatically respond using the protocol it detects the
	      client is using.  Practical effects of this are that you
	      can, for instance, give out a single URL and have it
	      viewable normally on desktop Web browsers and in WAP
	      mode on mobile phones -- and appropriately in various
	      Gopher browsers.
	    </P
></LI
><LI
><P
>Metadata and site links can be entered in a
	      variety of formats, including full UMN dotfile metadata
	      formats as well as Bucktooth gophermap files.  Moreover,
	      gophermap files are not limited to Gopher protocols, and
	      can be used for all protocols.
	    </P
></LI
><LI
><P
>Support for inter-protocol linking (linking
	  from Gopher sites to web sites)</P
></LI
><LI
><P
>Virtual folder system lets you serve up
	  anything as if it were regular files and directories.
	  PyGopherd comes with the following virtual folder systems
	      built in:</P
><P
></P
><UL
><LI
><P
>Can present any Unix MBOX, MMDF box, MH
		  directory, Maildir directory, or Babyl mailbox as a
		  virtual folder, the contents of which are the
		  messages in the mailbox.
		</P
></LI
><LI
><P
>Can use a configurable separator to
		  split a file into multiple parts, the first line of each
		  becoming the name for the virtual folder.</P
></LI
><LI
><P
>Can peek inside a ZIP file and serve it
	      up as first-class site citizens -- metadata can even be
	      stored in the ZIP files.
		</P
></LI
><LI
><P
>Can serve up the contents of a dictd
	      server as a filesystem.
		</P
></LI
></UL
></LI
><LI
><P
>	      Modular, extensible design: you can use PyGopherd's own
	      PYG extension format, or UMN- or Bucktooth-style
	      executables.
	    </P
></LI
><LI
><P
>	      Runs on any platform supported by Python 2.2 or 2.3.
	      This includes virtually every past and current flavor of
	      Unix (Linux, *BSD, Solaris, SunOS), Windows, MacOS 9.x
	      and X, and more.  Some features may not be available on
	      non-Unix platforms.
	    </P
></LI
><LI
><P
>Runs on any platform supported by Java 1.1
	  via the Jython Python implementation.</P
></LI
><LI
><P
>Tunable server types via configuration
	  directive -- forking or threading.</P
></LI
><LI
><P
>Secure design with support for chrooted execution.</P
></LI
><LI
><P
>Feature-complete, full implementations of:
	  Gopher0 (RFC1435), Gopher+, HTTP, and WAP.</P
></LI
><LI
><P
>Support for automatically finding the titles
	  of HTML documents for presentation in a directory.</P
></LI
><LI
><P
>Versatile configuration file format is both
	  extensible and nicely complementary of the module system.</P
></LI
><LI
><P
>Protocol-independant, handler-dependant
	  caching.  This increases performance by letting handlers
	  cache dynamically-generated information -- currently used by
	  the directory handlers.  This can improve performance of
	  directories by several orders of magnitude.  Because this is
	  a handler cache only, all protococls share the single
	  cache.  Since the processing time for the protocols is
	  negligable, this works out very well.</P
></LI
><LI
><P
>Autosensing of MIME types and gopher0 item
	  types.  Both are completely configurable.  MIME type
	  detection is done using a standard mime.types file, and
	  gopher0 types are calculated by using a configurable
	  regexp-based MIME-to-gophertype map.</P
></LI
><LI
><P
>Heavy support of regular expressions in configuration.</P
></LI
><LI
><P
>ProtocolMultiplexer and HandlerMultiplexer
	  let you choose only those protocols and handlers that you
	  wish your server to support and the order in which they are
	  tried when a request comes in.
	    </P
></LI
><LI
><P
>Full logging via syslog.</P
></LI
></UL
></DIV
><DIV
CLASS="REFSECT2"
><A
NAME="DESCRIPTION.ABOUTGOPHER"
></A
><H3
>About Gopher</H3
><P
>	  <SPAN
CLASS="APPLICATION"
>PyGopherd</SPAN
> started life as a server for the Gopher Internet
	  protocol. With Gopher, you can mount a filesystem (viewing files and
	  folders as if they were local),
	  browse Gopherspace with a web browser,
	  download files, and be interactive with searching.
	</P
><P
>	  But this is only part of the story. The world of Gopher is more
	  expansive than this. There are two major gopher protocols: Gopher0
	  (also known as RFC1436) and Gopher+. Gopher0 is a small, simple,
	  lightweight protocol that is very functional yet also extremely easy
	  to implement. Gopher0 clients can be easily places in small embedded
	  devices or in massive environments like a modern web browser.
	</P
><P
>	  Gopher+ is based on Gopher0 but extends it by providing document
	  metadata such as file size and MIME type. Gopher+ allows all sorts of
	  neat features, such as configurable metadata (serving up a bunch of
	  photos? Add a Subject field to your metadata to let
	  a customized photo
	  browser display who is pictured) and multiple
	  views of a file (let the
	  user select to view your photos as PNG or JPEG).
	</P
></DIV
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="QUICKSTART"
></A
><H2
>Quick Start</H2
><P
>	If you have already installed <SPAN
CLASS="APPLICATION"
>PyGopherd</SPAN
> system-wide, or your
	administrator has done that for you, your task for setting up
	<SPAN
CLASS="APPLICATION"
>PyGopherd</SPAN
> for the first time is quite simple.  You just need
	to set up your configuration file, make your folder directory,
	and run it!
      </P
><P
>	You can quickly set up your configuration file.  The
	distribution includes two files of interest:
	<TT
CLASS="FILENAME"
>conf/pygopherd.conf</TT
> and
	<TT
CLASS="FILENAME"
>conf/mime.types</TT
>.  Debian users will find
	the configuration file pre-installed in
	<TT
CLASS="FILENAME"
>/etc/pygopherd/pygopherd.conf</TT
> and the
	<TT
CLASS="FILENAME"
>mime.types</TT
> file provided by the system
	already.
      </P
><P
>	Open up <TT
CLASS="FILENAME"
>pygopherd.conf</TT
> in your editor and
	adjust to suit.  The file is heavily commented and you can
	refer to it for detailed information.  Some settings to take a
	look at include: <SPAN
CLASS="PROPERTY"
>detach</SPAN
>,
	<SPAN
CLASS="PROPERTY"
>pidfile</SPAN
>, <SPAN
CLASS="PROPERTY"
>port</SPAN
>, 
	<SPAN
CLASS="PROPERTY"
>usechroot</SPAN
>, <SPAN
CLASS="PROPERTY"
>setuid</SPAN
>,
	<SPAN
CLASS="PROPERTY"
>setgid</SPAN
>, and <SPAN
CLASS="PROPERTY"
>root</SPAN
>.
	These may or may not work at their defaults for you.  The
	remaining ones should be fine for a basic setup.
      </P
><P
>	Invoke <SPAN
CLASS="APPLICATION"
>PyGopherd</SPAN
> with <B
CLASS="COMMAND"
>pygopherd
	  path/to/configfile</B
> (or
	<B
CLASS="COMMAND"
>/etc/init.d/pygopherd start</B
> on Debian).
	Place some files in the location specified by the
	<SPAN
CLASS="PROPERTY"
>root</SPAN
> directive in the config file and
	you're ready to run!
      </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="INSTALLATION"
></A
><H2
>Installation</H2
><P
>	If  you  are  reading this document via the "man" command, it is likely
	that you have no installation tasks to perform; your system administra-
	tor  has already installed <SPAN
CLASS="APPLICATION"
>PyGopherd</SPAN
>.  If you need to install it yourself, you
	have three options: a system-wide installation with Debian, system-wide
	installation  with  other systems, and a single-user installation.  You
	can    download    the    latest    version    of    PyGopherd
	from
	<A
HREF="http://quux.org/devel/gopher/pygopherd/"
TARGET="_top"
>http://quux.org/devel/gopher/pygopherd/</A
>
      </P
><DIV
CLASS="REFSECT2"
><A
NAME="INSTALLATION.DEBIAN"
></A
><H3
>Debian System-Wide Installation</H3
><P
>	  If you are tracking Debian unstable, you may install
	  <SPAN
CLASS="APPLICATION"
>PyGopherd</SPAN
> by simply running this command as root:
	</P
><P
>	  <B
CLASS="COMMAND"
>apt-get install pygopherd</B
>
	</P
><P
>	  If you are not tracking Debian unstable, download the .deb
	  package from the <SPAN
CLASS="APPLICATION"
>PyGopherd</SPAN
> website and then run
	  <B
CLASS="COMMAND"
>dpkg -i</B
> to install the downloaded
	  package.  Then, skip to the configuration section below.
	  You will use <B
CLASS="COMMAND"
>/etc/init.d/pygopherd start</B
>
	  to start the program.
	</P
></DIV
><DIV
CLASS="REFSECT2"
><A
NAME="INSTALLATION.OTHER"
></A
><H3
>Other System-Wide Installation</H3
><P
>	  Download the tar.gz version of the package from the website.  Make
	  sure you have Python 2.2 or above installed; if now, download and
	  install it from <A
HREF="http://www.python.org/"
TARGET="_top"
>http://www.python.org/</A
>.  Then run these
	  commands:
	</P
><PRE
CLASS="PROGRAMLISTING"
>	  <B
CLASS="COMMAND"
>tar -zxvf pygopherd-x.y.z.tar.gz</B
>
	  <B
CLASS="COMMAND"
>cd pygopherd-x.y.z</B
>
	  <B
CLASS="COMMAND"
>python2.2 setup.py</B
>
	</PRE
><P
>	  Some systems will use <B
CLASS="COMMAND"
>python</B
> or
	  <B
CLASS="COMMAND"
>python2.3</B
> in place of
	  <B
CLASS="COMMAND"
>python2.2</B
>.
	</P
><P
>	  Next, proceed to configuration.  Make sure that the
	  <TT
CLASS="FILENAME"
>/etc/pygopherd/pygopherd.conf</TT
> file
	  names valid users (<SPAN
CLASS="PROPERTY"
>setuid</SPAN
> and
	  <SPAN
CLASS="PROPERTY"
>setgid</SPAN
> options) and a valid document
	  root (<SPAN
CLASS="PROPERTY"
>root</SPAN
> option).
	</P
><P
>	  You will type <TT
CLASS="FILENAME"
>pygopherd</TT
> to invoke the
	  program.
	</P
></DIV
><DIV
CLASS="REFSECT2"
><A
NAME="INSTALLATION.SINGLE"
></A
><H3
>Single-Account Installation</H3
><P
>	  Download the tar.gz version of the package from the website.  Make
	  sure you have Python 2.2 or above installed; if now, download and
	  install it from <A
HREF="http://www.python.org/"
TARGET="_top"
>http://www.python.org/</A
>.  Then run these
	  commands:
	</P
><PRE
CLASS="PROGRAMLISTING"
>	  <B
CLASS="COMMAND"
>tar -zxvf pygopherd-z.y.z.tar.gz</B
>
	  <B
CLASS="COMMAND"
>cd pygopherd-x.y.z</B
>
	</PRE
><P
>	  Modify <TT
CLASS="FILENAME"
>conf/pygopherd.conf</TT
> as follows:
	</P
><P
></P
><UL
><LI
><P
>Set <SPAN
CLASS="PROPERTY"
>usechroot = no</SPAN
></P
></LI
><LI
><P
>Comment out (add a # sign to the start of
	      the line) the <SPAN
CLASS="PROPERTY"
>pidfile</SPAN
>,
	      <SPAN
CLASS="PROPERTY"
>setuid</SPAN
>, and
	      <SPAN
CLASS="PROPERTY"
>setgid</SPAN
> lines.</P
></LI
><LI
><P
>Set <SPAN
CLASS="PROPERTY"
>root</SPAN
> to osomething appropriate.</P
></LI
><LI
><P
>Set <SPAN
CLASS="PROPERTY"
>port</SPAN
> to a number
	      greater than 1024.</P
></LI
></UL
><P
>	  When you want to run <SPAN
CLASS="APPLICATION"
>PyGopherd</SPAN
>, you will issue the
	  <B
CLASS="COMMAND"
>cd</B
> command as above and then type
	  <B
CLASS="COMMAND"
>PYTHONPATH=. bin/pygopherd</B
>.  There is no
	  installation step necessary.
	</P
></DIV
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="CONFIGURATION"
></A
><H2
>Configuration</H2
><P
>	<SPAN
CLASS="APPLICATION"
>PyGopherd</SPAN
> is regulated by a configuratoin file normally
	stored in <TT
CLASS="FILENAME"
>/etc/pygopherd/pygopherd.conf</TT
>.
	You can specify an alternate configuration file on the command
	line.  The <SPAN
CLASS="APPLICATION"
>PyGopherd</SPAN
> distribution ships
	with a sample <TT
CLASS="FILENAME"
>pygopherd.conf</TT
> file that
	thoroughly documents the configuration file options and
	settings.
      </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="OPTIONS"
></A
><H2
>Options</H2
><P
>	All <SPAN
CLASS="APPLICATION"
>PyGopherd</SPAN
> configuratoin is done via the configuration
	file.  Therefore, the program has only one command-line
	option:
      </P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><VAR
CLASS="REPLACEABLE"
>configfile</VAR
></DT
><DD
><P
>This option argument specifies the location
	      of the configuration file that <SPAN
CLASS="APPLICATION"
>PyGopherd</SPAN
> is to use.</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="HANDLERS"
></A
><H2
>Handlers</H2
><P
>	<SPAN
CLASS="APPLICATION"
>PyGopherd</SPAN
> defines several handlers which are responsible for
	finding data on your server and presenting it to the user.  The
	handlers are used to generate things like links to other documents and
	directory listings.  They are also responsible for serving up regular
	files and even virtual folders.
      </P
><P
>	Handlers are specified with the <SPAN
CLASS="PROPERTY"
>handlers</SPAN
>
	option in <TT
CLASS="FILENAME"
>pygopherd.conf</TT
>.  This option is
	a list of handlers to use.  For each request that arrives,
	<SPAN
CLASS="APPLICATION"
>PyGopherd</SPAN
> will ask each handler in
	turn whether or not it can handle the request, and will handle the
	request according to the first handler that is capable of doing so.
	If no handlers can handle the request, a file not found error is
	generated.  See the example configuration file for an example.
      </P
><P
>	The remaining parts of this section describe the different
	handlers that ship with <SPAN
CLASS="APPLICATION"
>PyGopherd</SPAN
>.
      </P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>dir.DirHandler</DT
><DD
><P
>	      This handler is a basic one that generates menus based
	      on the contents of a directory.  It is used for
	      directories that contain neither a
	      <TT
CLASS="FILENAME"
>gophermap</TT
> file nor UMN-style links
	      files, or situations where you have no need for either
	      of those.</P
><P
>	      This handler simply
	      reads the contents of your on-disk directory, determines the
	      appropriate types of each file, and sends the result to the client.
	      The descriptions of each item are usually set to the filename, but the
	      <SPAN
CLASS="PROPERTY"
>html.HTMLFileTitleHandler</SPAN
> may
	      override that.
	    </P
></DD
><DT
>gophermap.BuckGophermapHandler</DT
><DD
><P
>	      This handler is used to generate directory listings
	      based on <TT
CLASS="FILENAME"
>gophermap</TT
> files.  It will
	      not read the directory on-disk, instead serving content
	      from the <TT
CLASS="FILENAME"
>gophermap</TT
> file only.
	      Gophermaps are useful if you want to present a directory
	      in which the files do not frequently change and there is
	      general information to present.  Overall, if you only
	      wish to present information particular to certain files,
	      you should consider using the abstract feature of
	      UMN.UMNDirHandler.
	    </P
><P
>	      The <TT
CLASS="FILENAME"
>gophermap</TT
> files contain two
	      types of lines, which are described here using the same
	      convention normally used for command line arguments.  In
	      this section, the symbol \t will be used to indicate a
	      tab character, Control-I.
	    </P
><P
> <VAR
CLASS="REPLACEABLE"
>full line of informational
		text</VAR
> </P
><P
> <VAR
CLASS="REPLACEABLE"
>gophertypeDESCRIPTION</VAR
>  [\t<VAR
CLASS="REPLACEABLE"
>selector</VAR
> [\t<VAR
CLASS="REPLACEABLE"
>host</VAR
> [\t<VAR
CLASS="REPLACEABLE"
>port</VAR
>]]]</P
><P
>	      Foo
	    </P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN229"
></A
><H2
>Examples</H2
><P
>Here are some example configurations for various situations.
	Please e-mail any other examples you have that may be useful to
	me.
      </P
><DIV
CLASS="REFSECT2"
><A
NAME="AEN232"
></A
><H3
>Multiple Accounts with Mutt</H3
><P
>	  This example shows you how to set up <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> to
	  synchronize multiple accounts with the mutt mail reader.
	</P
><P
>	  Start by creating a directory to hold your folders by running
	  <B
CLASS="COMMAND"
>mkdir ~/Mail</B
>.  Then, in your
	  <TT
CLASS="FILENAME"
>~/.offlineimaprc</TT
>, specify:
	</P
><PRE
CLASS="PROGRAMLISTING"
>accounts = Personal, Work</PRE
><P
>	  Make sure that you have both an
	  <SPAN
CLASS="PROPERTY"
>[Account Personal]</SPAN
>
	  and an <SPAN
CLASS="PROPERTY"
>[Account Work]</SPAN
> section.  The
	  local repository for each account must have different
	  <SPAN
CLASS="PROPERTY"
>localfolder</SPAN
> path names.
	  Also, make sure
	  to enable <SPAN
CLASS="PROPERTY"
>[mbnames]</SPAN
>.
	</P
><P
>	  In each local repository section, write something like this:
	</P
><PRE
CLASS="PROGRAMLISTING"
>localfolders = ~/Mail/Personal</PRE
><P
>	  Finally, add these lines to your <TT
CLASS="FILENAME"
>~/.muttrc</TT
>:
	</P
><PRE
CLASS="PROGRAMLISTING"
>source ~/path-to-mbnames-muttrc-mailboxes
folder-hook Personal set from="youremail@personal.com"
folder-hook Work set from="youremail@work.com"
set mbox_type=Maildir
set folder=$HOME/Mail
spoolfile=+Personal/INBOX</PRE
><P
>	  That's it!
	</P
></DIV
><DIV
CLASS="REFSECT2"
><A
NAME="AEN251"
></A
><H3
>UW-IMAPD and References</H3
><P
>Some users with a UW-IMAPD server need to use <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
>'s
	  "reference" feature to get at their mailboxes, specifying a reference
	  of "~/Mail" or "#mh/" depending on the configuration.  The below
	  configuration from (originally from docwhat@gerf.org)
	  shows using a <SPAN
CLASS="PROPERTY"
>reference</SPAN
> of Mail, a <SPAN
CLASS="PROPERTY"
>nametrans</SPAN
>
	  that strips
	  the leading Mail/ off incoming folder names, and a
	  <SPAN
CLASS="PROPERTY"
>folderfilter</SPAN
> that
	  limits the folders synced to just three.
	</P
><PRE
CLASS="PROGRAMLISTING"
>[Account Gerf]
localrepository = GerfLocal
remoterepository = GerfRemote

[Repository GerfLocal]
type = Maildir
localfolders = ~/Mail

[Repository GerfRemote]
type = IMAP
remotehost = gerf.org
ssl = yes
remoteuser = docwhat
reference = Mail
# Trims off the preceeding Mail on all the folder names.
nametrans = lambda foldername: \
            re.sub('^Mail/', '', foldername)
# Yeah, you have to mention the Mail dir, even though it
# would seem intuitive that reference would trim it.
folderfilter = lambda foldername: foldername in [
      'Mail/INBOX',
      'Mail/list/zaurus-general',
      'Mail/list/zaurus-dev',
      ]
maxconnections = 1
holdconnectionopen = no</PRE
></DIV
><DIV
CLASS="REFSECT2"
><A
NAME="AEN259"
></A
><H3
>pythonfile Configuration File Option</H3
><P
>You can have <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
>
	  load up a Python file before evaluating the
	  configuration file options that are Python expressions.  This example
	  is based on one supplied by Tommi Virtanen for this feature.
	</P
><P
>	  In <TT
CLASS="FILENAME"
>~/.offlineimap.rc</TT
>, he adds these options:
	</P
><PRE
CLASS="PROGRAMLISTING"
>[general]
pythonfile=~/.offlineimap.py
[Repository foo]
foldersort=mycmp</PRE
><P
>	  Then, the <TT
CLASS="FILENAME"
>~/.offlineimap.py</TT
> file will
	  contain:
	</P
><PRE
CLASS="PROGRAMLISTING"
>prioritized = ['INBOX', 'personal', 'announce', 'list']

def mycmp(x, y):
   for prefix in prioritized:
       if x.startswith(prefix):
           return -1
       elif y.startswith(prefix):
           return +1
   return cmp(x, y)

def test_mycmp():
   import os, os.path
   folders=os.listdir(os.path.expanduser('~/data/mail/tv@hq.yok.utu.fi'))
   folders.sort(mycmp)
   print folders</PRE
><P
>	  This code snippet illustrates how the <SPAN
CLASS="PROPERTY"
>foldersort</SPAN
>
	  option can be customized with a Python function from the
	  <SPAN
CLASS="PROPERTY"
>pythonfile</SPAN
> to always synchronize certain
	  folders first.
	</P
></DIV
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN272"
></A
><H2
>Errors</H2
><P
>	If you get one of some frequently-encountered or confusing errors,
	please check this section.
      </P
><DIV
CLASS="REFSECT2"
><A
NAME="AEN275"
></A
><H3
>UID validity problem for folder</H3
><P
>IMAP servers use a unique ID (UID) to refer to a specific message.
	  This number is guaranteed to be unique to a particular message
	  <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>forever</I
></SPAN
>.
	  No other message in the same folder will ever get the same
	  UID.  UIDs are an integral part of <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
>'s synchronization
	  scheme; they are used to match up messages on your computer to
	  messages on the server.
	</P
><P
>	  Sometimes, the UIDs on the server might get reset.  Usually this will
	  happen if you delete and then recreate a folder.  When you create a
	  folder, the server will often start the UID back from 1.  But
	  <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> might still have the UIDs from the previous folder by the
	  same name stored.  <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> will detect this condition and skip the
	  folder.  This is GOOD, because it prevents data loss.
	</P
><P
>	  You can fix it by removing your local folder and cache data.  For
	  instance, if your folders are under <TT
CLASS="FILENAME"
>~/Folders</TT
>
	  and the folder with the problem is INBOX, you'd type this:
	</P
><PRE
CLASS="PROGRAMLISTING"
>rm -r ~/Folders/INBOX
rm -r ~/.offlineimap/Account-<VAR
CLASS="REPLACEABLE"
>AccountName</VAR
>
rm -r ~/.offlineimap/Repository-<VAR
CLASS="REPLACEABLE"
>RepositoryName</VAR
></PRE
><P
>	  (Of course, replace AccountName and RepositoryName 
	  with the names as specified
	  in <TT
CLASS="FILENAME"
>~/.offlineimaprc</TT
>).
	</P
><P
>Next time you run <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
>, it will re-download
	  the folder with the
	  new UIDs.  Note that the procedure specified above will lose any local
	  changes made to the folder.
	</P
><P
>	  Some IMAP servers are broken and do not support UIDs properly.  If you
	  continue to get this error for all your folders even after performing
	  the above procedure, it is likely that your IMAP server falls into
	  this category.  <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> is incompatible with such servers.
	  Using <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> with them will not destroy any mail, but at the same time,
	  it will not actually synchronize it either.  (<SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> will detect
	  this condition and abort prior to synchronization.)
	</P
><P
>	  This question comes up frequently on the
	  <A
HREF="http://lists.complete.org/offlineimap@complete.org/"
TARGET="_top"
><SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
>
	  mailing list</A
>.  You can find a
	  <A
HREF="http://lists.complete.org/offlineimap@complete.org/2003/04/msg00012.html.gz"
TARGET="_top"
>detailed
	  discussion</A
> of the problem there.
	</P
></DIV
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN300"
></A
><H2
>Other Frequently Asked Questions</H2
><P
>There are some other FAQs that might not fit into another section
	of the document, so they are discussed here.
      </P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>What platforms does <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> run on?</DT
><DD
><P
>	    It should run on most platforms supported by Python, which are quite a
	    few.
	  </P
></DD
><DT
>I'm using Mutt.  Other IMAP sync programs require me to use "set maildir_trash=yes".  Do I need to do that with <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
>?</DT
><DD
><P
>	    No.  <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> is smart enough to figure out message deletion without this extra
	    crutch.  You'll get the best results if you don't use this setting, in
	    fact.
	  </P
></DD
><DT
>I've upgraded and now <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
>
	crashes when I start it up!  Why?</DT
><DD
><P
>You need to upgrade your configuration
	file.  See  at the end of this
	      manual.
	    </P
></DD
><DT
>How do I specify the names of my folders?</DT
><DD
><P
>	    You do not need to.  <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> is smart
	    enough to automatically figure out what folders are present
	    on the IMAP server and synchronize them.  You can use the
	    <SPAN
CLASS="PROPERTY"
>folderfilter</SPAN
> and <SPAN
CLASS="PROPERTY"
>foldertrans</SPAN
>
	    configuration file options to request certain folders and rename them
	    as they come in if you like.
	  </P
></DD
><DT
>How can I prevent certain folders from being synced?</DT
><DD
><P
>	    Use the <SPAN
CLASS="PROPERTY"
>folderfilter</SPAN
> option in the configuration file.
	  </P
></DD
><DT
>How can I add or delete a folder?</DT
><DD
><P
>	    <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> does not currently provide this feature, but if you create a new
	    folder on the IMAP server, it will be created locally automatically.
	  </P
></DD
><DT
>Are there any other warnings that I should be aware of?</DT
><DD
><P
>	    Yes; see the Notes section below.
	  </P
></DD
><DT
>What is the mailbox name recorder (mbnames) for?</DT
><DD
><P
>Some mail readers, such as Mutt, are not capable
	    of automatically determining the names of your mailboxes.
	    <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> can help these programs by writing the names
	    of the folders ni a format you specify.  See the example
	    <TT
CLASS="FILENAME"
>offlineimap.conf</TT
> for details.
	  </P
></DD
><DT
>Can I synchronize multiple accounts with <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
>?</DT
><DD
><P
>Sure.  Just name them all in the
	    <SPAN
CLASS="PROPERTY"
>accounts</SPAN
> line in the <SPAN
CLASS="PROPERTY"
>general</SPAN
>
	    section of the configuration file, and add a per-account section
	    for each one.
	  </P
></DD
><DT
>Does <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> support POP?</DT
><DD
><P
>No.  POP is not robust enough to do a completely reliable
	    multi-machine synchronization like <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> can do.  <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
>
	    will not support it.
	  </P
></DD
><DT
>Does <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> support mailbox formats other than Maildir?</DT
><DD
><P
>Not at present.  There is no technical reason not to; just no
	    demand yet.  Maildir is a superior format anyway.
	      However, <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> can sync between two IMAP
	  servers, and some IMAP servers support other formats.  You
	  could install an IMAP server on your local machine and have
	  <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> sync to that.
	  </P
></DD
><DT
>[technical] Why are your Maildir message filenames so huge?</DT
><DD
><P
><SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> has two relevant principles: 1) never modifying your
	    messages in any way and 2) ensuring 100% reliable synchronizations.
	    In order to do a reliable sync, <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
>
	    must have a way to
	    uniquely identify each e-mail.  Three pieces of information are
	    required to do this: your account name, the folder name, and the
	    message UID.  The account name can be calculated from the path in
	    which your messages are.  The folder name can usually be as well, BUT
	    some mail clients move messages between folders by simply moving the
	    file, leaving the name intact.
	  </P
><P
>	    So, <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> must store both a UID folder ID.  The folder ID is
	    necessary so <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> can detect a message moved to a different
	    folder.  <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> stores the UID (U= number) and an md5sum of the
	    foldername (FMD5= number) to facilitate this.
	  </P
></DD
><DT
>What is the speed of <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
>'s sync?</DT
><DD
><P
>OfflineIMAP
	    versions 2.0 and above contain a multithreaded system.  A good way to
	    experiment is by setting <SPAN
CLASS="PROPERTY"
>maxsyncaccounts</SPAN
> to 3 and <SPAN
CLASS="PROPERTY"
>maxconnections</SPAN
> to 3
	    in each account clause.
	  </P
><P
>This lets OfflineIMAP open up multiple connections simultaneously.
	    That will let it process multiple folders and messages at once.  In
	    most cases, this will increase performance of the sync.
	  </P
><P
>Don't set the number too high.  If you do that, things might actually
	    slow down as your link gets saturated.  Also, too many connections can
	    cause mail servers to have excessive load.  Administrators might take
	    unkindly to this, and the server might bog down.  There are many
	    variables in the optimal setting; experimentation may help.
	  </P
><P
>An informal benchmark yields these results for my setup:
	  </P
><P
></P
><UL
><LI
><P
>10 minutes with MacOS X Mail.app "manual cache"
	      </P
></LI
><LI
><P
>5 minutes with GNUS agent sync</P
></LI
><LI
><P
>20 seconds with OfflineIMAP 1.x</P
></LI
><LI
><P
>9 seconds with OfflineIMAP 2.x</P
></LI
><LI
><P
>3 seconds with OfflineIMAP 3.x "cold start"</P
></LI
><LI
><P
>2 seconds with OfflineIMAP 3.x "held connection"</P
></LI
></UL
></DD
></DL
></DIV
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN402"
></A
><H2
>Conforming To</H2
><P
></P
><UL
><LI
><P
>Internet Message Access Protocol version 4rev1 (IMAP 4rev1) as
	  specified in RFC2060 and RFC3501</P
></LI
><LI
><P
>CRAM-MD5 as specified in RFC2195</P
></LI
><LI
><P
>Maildir as specified in
	  <A
HREF="http://www.qmail.org/qmail-manual-html/man5/maildir.html"
TARGET="_top"
>the Maildir manpage</A
> and
	  <A
HREF="http://cr.yp.to/proto/maildir.html"
TARGET="_top"
>the qmail website</A
>.</P
></LI
><LI
><P
>Standard Python 2.2.1 as implemented on POSIX-compliant systems.</P
></LI
></UL
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN415"
></A
><H2
>Notes</H2
><DIV
CLASS="REFSECT2"
><A
NAME="AEN417"
></A
><H3
>Deleting Local Folders</H3
><P
><SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> does a two-way synchronization.  That is, if you
	  make a change to the mail on the server, it will be propogated to your
	  local copy, and vise-versa.  Some people might think that it would be
	  wise to just delete all their local mail folders periodically.  If you
	  do this with <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
>, remember to also remove your local status
	  cache (<TT
CLASS="FILENAME"
>~/.offlineimap</TT
> by default).  Otherwise, <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> will take
	  this as an intentional deletion of many messages and will interpret
	  your action as requesting them to be deleted from the server as well.
	  (If you don't understand this, don't worry; you probably won't
	  encounter this situation)
	</P
></DIV
><DIV
CLASS="REFSECT2"
><A
NAME="AEN424"
></A
><H3
>Multiple Instances</H3
><P
><SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> is not designed to have several instances (for instance, a cron job and an interactive invocation) run over the same
	  mailbox simultaneously.  It will perform a check on startup and
	  abort if another <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> is already running.  If you need
	  to schedule synchronizations, please use the
	  <SPAN
CLASS="PROPERTY"
>autorefresh</SPAN
> settings rather than cron.
	  Alternatively, you can set a separate <SPAN
CLASS="PROPERTY"
>metadata</SPAN
>
	  directory for each instance.
	</P
></DIV
><DIV
CLASS="REFSECT2"
><A
NAME="AEN431"
></A
><H3
>Copying Messages Between Folders</H3
><P
>	  Normally, when you copy a message between folders or add a new message
	  to a folder locally, <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
>
	  will just do the right thing.  However, sometimes this can be tricky
	  -- if your IMAP server does not provide the SEARCH command, or does
	  not return something useful, <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
>
	  cannot determine the new UID of the message.  So, in these rare
	  instances, OfflineIMAP will upload the message to the IMAP server and
	  delete it from your local folder.  Then, on your next sync, the
	  message will be re-downloaded with the proper UID.
	  <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> makes sure that the message was properly uploaded before deleting it,
	  so there should be no risk of data loss.
	</P
></DIV
><DIV
CLASS="REFSECT2"
><A
NAME="AEN437"
></A
><H3
>Use with Evolution</H3
><P
><SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> can work with Evolution.  To do so, first configure
	  your <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> account to have
	  <VAR
CLASS="OPTION"
>sep = /</VAR
> in its configuration.  Then, configure
	  Evolution with the
	  "Maildir-format mail directories" server type.  For the path, you will need to
	  specify the name of the top-level folder
	  <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>inside</I
></SPAN
> your <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> storage location.
	  You're now set!
	</P
></DIV
><DIV
CLASS="REFSECT2"
><A
NAME="AEN445"
></A
><H3
>Use with KMail</H3
><P
>At this time, I believe that <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> with Maildirs
	  is not compatible
	  with KMail.  KMail cannot work in any mode other than to move
	  all messages out of all folders immediately, which (besides being annoying
	  and fundamentally broken) is incompatible with
	<SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
>.
	</P
><P
>	  However, I have made KMail version 3 work well with
	  <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> by installing an IMAP server on my local
	  machine, having <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> sync to that, and pointing
	  KMail at the same server.
	</P
></DIV
><DIV
CLASS="REFSECT2"
><A
NAME="AEN453"
></A
><H3
>Mailing List</H3
><P
>There is an OfflineIMAP mailing list available.
	  To subscribe, send the text "Subscribe" in the subject of a mail to
	  offlineimap-request@complete.org.  To post, send the message to
	  offlineimap@complete.org.  Archives are available at
	  <A
HREF="http://lists.complete.org/offlineimap@complete.org/"
TARGET="_top"
>http://lists.complete.org/offlineimap@complete.org/</A
>.
	</P
></DIV
><DIV
CLASS="REFSECT2"
><A
NAME="AEN457"
></A
><H3
>Bugs</H3
><P
>Reports of bugs should be sent via e-mail to the
	  <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> bug-tracking system (BTS) at
	  offlineimap@bugs.complete.org or submitted online using
	  the <A
HREF="http://bugs.complete.org/"
TARGET="_top"
>web interface</A
>.
	</P
><P
>	  The Web site also lists all current bugs, where you can check their
	  status or contribute to fixing them.
	</P
></DIV
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="UPGRADING.4.0"
></A
><H2
>Upgrading to 4.0</H2
><P
>	If you are upgrading from a version of <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> prior to
	3.99.12, you will find that you will get errors when
	<SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> starts up (relating to ConfigParser or
	AccountHashGenerator) and the
	configuration file.  This is because the config file format
	had to change to accomodate new features in 4.0.  Fortunately,
	it's not difficult to adjust it to suit.
      </P
><P
>	First thing you need to do is stop any running <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
>
	instance, making sure first that it's synced all your mail.
	Then, modify your
	<TT
CLASS="FILENAME"
>~/.offlineimaprc</TT
> file.  You'll need to
	split up each account section (make sure that it now starts
	with "Account ") into two Repository sections (one for the
	local side and another for the remote side.)  See the files
	<TT
CLASS="FILENAME"
>offlineimap.conf.minimal</TT
> and
	<TT
CLASS="FILENAME"
>offlineimap.conf</TT
> in the distribution if
	you need more assistance.
      </P
><P
>	<SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
>'s status directory area has also changed.
	Therefore, you should delete everything in ~/.offlineimap as
	well as your local mail folders.
      </P
><P
>	When you start up <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> 4.0, it will re-download all
	your mail from the server and then you can continue using it
	like normal.
      </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN477"
></A
><H2
>Copyright</H2
><P
>OfflineIMAP, and this manual, are Copyright &copy; 2002, 2003 John Goerzen.</P
><P
>	This program is free software; you can redistribute it and/or modify
	it under the terms of the GNU General Public License as published by
	the Free Software Foundation; either version 2 of the License, or
	(at your option) any later version.
      </P
><P
>	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU General Public License for more details.
      </P
><P
>	You should have received a copy of the GNU General Public License
	along with this program; if not, write to the Free Software
	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA</P
><P
>imaplib.py comes from the Python dev tree and is licensed under
	the GPL-compatible PSF license as stated in the file
	<TT
CLASS="FILENAME"
>COPYRIGHT</TT
> in the <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
>
         distribution.
      </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN486"
></A
><H2
>Author</H2
><P
><SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
>, its libraries, documentation, and all included files, except where
	noted, was written by John Goerzen <CODE
CLASS="EMAIL"
>&#60;<A
HREF="mailto:jgoerzen@complete.org"
>jgoerzen@complete.org</A
>&#62;</CODE
> and
	copyright is held as stated in the COPYRIGHT section.
      </P
><P
>	<SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> may be downloaded, and information found, from its
	homepage via either <A
HREF="gopher://quux.org/1/devel/offlineimap"
TARGET="_top"
>Gopher</A
>
	or <A
HREF="http://quux.org/devel/offlineimap"
TARGET="_top"
>HTTP</A
>.
      </P
><P
>	<SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> may also be downloaded using Subversion.  Additionally,
	the distributed tar.gz may be updated with a simple "svn update"
	command; it is ready to go.  For information on getting OfflineIMAP
	with Subversion, please visit the
	<A
HREF="http://svn.complete.org/"
TARGET="_top"
>complete.org Subversion page</A
>.
      </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN498"
></A
><H2
>See Also</H2
><P
><SPAN
CLASS="APPLICATION"
>mutt</SPAN
>(1),
	<SPAN
CLASS="APPLICATION"
>python</SPAN
>(1)
      </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN503"
></A
><H2
>History</H2
><P
>	Detailed history may be found in the file ChangeLog in the
	<SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> distribution.  Feature and bug histories may be
	found in the file debian/changelog which, despite its name, is
	not really Debian-specific.  This section provides a large
	overview.
      </P
><P
>	Development on <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> began on June 18, 2002.  Version
	1.0.0 was released three days later on June 21, 2002.  Point
	releases followed, including speed optimizations and some
	compatibility fixes.
      </P
><P
>Version 2.0.0 was released on July 3, 2002, and
	represented the first time the synchronization became
	multithreaded and, to the best of my knowledge, the first
	multithreaded IMAP syncrhonizing application in existance.
	The last 2.0.x release, 2.0.8, was made on July 9.
      </P
><P
>	Version 3.0.0 was released on July 11, 2002, and introduced
	modular user interfaces and the first GUI interface for
	<SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
>.  This manual also was introduced with 3.0.0,
	along with many command-line options.  Version 3.1.0 was
	released on July 21, adding the Noninteractive user
	interfaces, profiling support, and several bugfixes.  3.2.0
	was released on July 24, adding support for the Blinkenlights
	GUI interface.  <SPAN
CLASS="APPLICATION"
>OfflineIMAP</SPAN
> entered maintenance mode for
	awhile, as it had reached a feature-complete milestone in my
	mind.
      </P
><P
>	The 3.99.x branch began in on October 7, 2002, to begin work
	for 4.0.  The Curses.Blinkenlights interface was added in
	3.99.6, and many architectural changes were made.
      </P
><P
>	4.0.0 was released on July 18, 2003, including the ability to
            synchronize directly between two IMAP servers, the first
            re-architecting of the configuration file to refine the
            notion of an account, and the new Curses interface.
      </P
></DIV
></DIV
></BODY
></HTML
>